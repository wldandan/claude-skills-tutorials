# ç‰¹æ€§ 09: æŒ‡æ ‡é‡‡é›†ä¸å­˜å‚¨å¼•æ“

## åŠŸèƒ½æ¦‚è¿°

æä¾›é«˜æ€§èƒ½çš„æŒ‡æ ‡é‡‡é›†ä¸å­˜å‚¨å¼•æ“ï¼Œä½œä¸º AIOps CLI å·¥å…·çš„æ•°æ®åŸºç¡€è®¾æ–½ã€‚æ”¯æŒä» OS å¤šç»´åº¦é‡‡é›†ç³»ç»ŸæŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œã€è¿›ç¨‹ç­‰ï¼‰ï¼Œé«˜æ•ˆå­˜å‚¨åˆ°æœ¬åœ°æˆ–è¿œç¨‹æ—¶åºæ•°æ®åº“ï¼Œå¹¶æä¾›çµæ´»çš„æŸ¥è¯¢æ¥å£ä¾›ä¸Šå±‚åˆ†ææ¨¡å—ä½¿ç”¨ã€‚

## ç”¨æˆ·åœºæ™¯

**åœºæ™¯ 1: å¯åŠ¨æ•°æ®é‡‡é›†**
- éƒ¨ç½² AIOps å·¥å…·ï¼Œéœ€è¦å¼€å§‹é‡‡é›†ç³»ç»ŸæŒ‡æ ‡
- éœ€è¦é…ç½®é‡‡é›†é¢‘ç‡ã€ä¿ç•™ç­–ç•¥ã€å­˜å‚¨ä½ç½®
- ä½¿ç”¨ `aiops collector start` å¯åŠ¨é‡‡é›†æœåŠ¡

**åœºæ™¯ 2: æŸ¥è¯¢å†å²æ•°æ®**
- åˆ†æè¿‡å»æŸä¸ªæ—¶æ®µçš„æ€§èƒ½é—®é¢˜
- éœ€è¦æŸ¥è¯¢å†å²æŒ‡æ ‡æ•°æ®
- ä½¿ç”¨ `aiops query --start <time> --end <time>` æŸ¥è¯¢æ•°æ®

**åœºæ™¯ 3: å¯¼å‡ºæ•°æ®**
- éœ€è¦å°†æ•°æ®å¯¼å‡ºåˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ Prometheusã€Grafanaï¼‰
- ä½¿ç”¨ `aiops export --format prometheus` å¯¼å‡ºæ•°æ®

## æŠ€æœ¯æ–¹æ¡ˆæ¦‚è¦

### é‡‡é›†æ¶æ„
- **Agent æ¨¡å¼**: è½»é‡çº§ Agentï¼Œå¸¸é©»å†…å­˜ï¼Œå‘¨æœŸæ€§é‡‡é›†
- **Push æ¨¡å¼**: Agent ä¸»åŠ¨æ¨é€æ•°æ®åˆ°å­˜å‚¨
- **Pull æ¨¡å¼**: å­˜å‚¨æœåŠ¡ä¸»åŠ¨æ‹‰å–æ•°æ®ï¼ˆå…¼å®¹ Prometheusï¼‰
- **å¤šçº¿ç¨‹é‡‡é›†**: å¹¶å‘é‡‡é›†å¤šä¸ªæŒ‡æ ‡æºï¼Œæé«˜æ•ˆç‡

### é‡‡é›†æŒ‡æ ‡
- **ç³»ç»ŸæŒ‡æ ‡**: CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œã€è´Ÿè½½
- **è¿›ç¨‹æŒ‡æ ‡**: è¿›ç¨‹åˆ—è¡¨ã€èµ„æºå ç”¨ã€è¿›ç¨‹æ ‘
- **æ–‡ä»¶ç³»ç»Ÿ**: ç£ç›˜ä½¿ç”¨ã€inodeã€æ–‡ä»¶æ•°
- **ç½‘ç»œ**: è¿æ¥æ•°ã€æµé‡ã€TCP ç»Ÿè®¡
- **å†…æ ¸**: å†…æ ¸å‚æ•°ã€å†…æ ¸ç»Ÿè®¡ã€ä¸­æ–­
- **æ—¥å¿—**: ç³»ç»Ÿæ—¥å¿—ã€åº”ç”¨æ—¥å¿—ï¼ˆå¯é€‰ï¼‰

### å­˜å‚¨æ–¹æ¡ˆ
- **æœ¬åœ°å­˜å‚¨**: SQLiteï¼ˆé»˜è®¤ï¼Œè½»é‡çº§ï¼‰
- **æ—¶åºæ•°æ®åº“**: InfluxDB 2.xï¼ˆå¯é€‰ï¼Œé«˜æ€§èƒ½ï¼‰
- **Prometheus**: å…¼å®¹ Prometheus æ ¼å¼ï¼ˆå¯é€‰ï¼‰
- **è¿œç¨‹å­˜å‚¨**: æ”¯æŒ PostgreSQLã€TimescaleDBï¼ˆå¯é€‰ï¼‰

### æ•°æ®å‹ç¼©ä¸å½’æ¡£
- **æ•°æ®å‹ç¼©**: ä½¿ç”¨ Zstdã€LZ4 å‹ç¼©å†å²æ•°æ®
- **æ•°æ®é™é‡‡æ ·**: è€æ•°æ®è‡ªåŠ¨é™é‡‡æ ·ï¼ˆå¦‚ 1ç§’ â†’ 1åˆ†é’Ÿ â†’ 1å°æ—¶ï¼‰
- **æ•°æ®å½’æ¡£**: æ”¯æŒå½’æ¡£åˆ°å¯¹è±¡å­˜å‚¨ï¼ˆS3ã€OSSï¼‰
- **æ•°æ®æ¸…ç†**: è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®

## æ ¸å¿ƒåŠŸèƒ½ç‚¹

### 1. é‡‡é›†æœåŠ¡ç®¡ç†
```bash
# å¯åŠ¨é‡‡é›†æœåŠ¡
aiops collector start --config /etc/aiops/collector.yaml

# åœæ­¢é‡‡é›†æœåŠ¡
aiops collector stop

# æŸ¥çœ‹é‡‡é›†æœåŠ¡çŠ¶æ€
aiops collector status

# é‡å¯é‡‡é›†æœåŠ¡
aiops collector restart
```

### 2. é‡‡é›†é…ç½®
```bash
# é…ç½®é‡‡é›†å‚æ•°
aiops collector config --set interval=10s
aiops collector config --set retention=30d
aiops collector config --set storage.backend=sqlite
```

### 3. å®æ—¶é‡‡é›†
```bash
# å®æ—¶é‡‡é›†æŒ‡æ ‡ï¼ˆä¸€æ¬¡æ€§ï¼‰
aiops collect --duration 60s --output metrics.json
```

### 4. æ•°æ®æŸ¥è¯¢
```bash
# æŸ¥è¯¢æŒ‡æ ‡æ•°æ®
aiops query --metric cpu.percent --start "2024-01-15 10:00" --end "2024-01-15 11:00"

# æŸ¥è¯¢å¤šæŒ‡æ ‡
aiops query --metrics cpu.percent,mem.percent --period 1h

# èšåˆæŸ¥è¯¢
aiops query --metric cpu.percent --agg avg --interval 1m
```

### 5. æ•°æ®å¯¼å‡º
```bash
# å¯¼å‡ºä¸º Prometheus æ ¼å¼
aiops export --format prometheus --output /tmp/metrics.prom

# å¯¼å‡ºä¸º JSON
aiops export --format json --output metrics.json

# å¯¼å‡ºä¸º CSV
aiops export --format csv --output metrics.csv
```

### 6. å­˜å‚¨ç®¡ç†
```bash
# æŸ¥çœ‹å­˜å‚¨çŠ¶æ€
aiops storage status

# æ¸…ç†è¿‡æœŸæ•°æ®
aiops storage clean --before 2024-01-01

# å‹ç¼©æ•°æ®
aiops storage compress

# å¤‡ä»½æ•°æ®
aiops storage backup --output /backup/aiops_backup.db
```

### 7. æ•°æ®æºç®¡ç†
```bash
# æ·»åŠ æ•°æ®æº
aiops collector source add --name prometheus --url http://prometheus:9090

# åˆ—å‡ºæ•°æ®æº
aiops collector source list

# åˆ é™¤æ•°æ®æº
aiops collector source remove --name prometheus
```

### 8. é‡‡é›†ç»Ÿè®¡
```bash
# æŸ¥çœ‹é‡‡é›†ç»Ÿè®¡
aiops collector stats

# æŸ¥çœ‹é‡‡é›†æ—¥å¿—
aiops collector logs --tail 100
```

## éªŒæ”¶æ ‡å‡† (Acceptance Criteria)

### AC 1: é‡‡é›†å‡†ç¡®æ€§
- **Given**: é…ç½®é‡‡é›†é—´éš”ä¸º 10 ç§’
- **When**: è¿è¡Œé‡‡é›†æœåŠ¡ 1 åˆ†é’Ÿ
- **Then**:
  - é‡‡é›† 6 ä¸ªæ•°æ®ç‚¹ï¼ˆ10 ç§’é—´éš”ï¼‰
  - æ¯ä¸ªæ•°æ®ç‚¹çš„æŒ‡æ ‡å€¼å‡†ç¡®ï¼ˆä¸ç³»ç»Ÿå®é™…å€¼å¯¹æ¯”è¯¯å·® < 1%ï¼‰
  - é‡‡é›†æ—¶é—´æˆ³å‡†ç¡®ï¼ˆè¯¯å·® < 1 ç§’ï¼‰

### AC 2: é‡‡é›†æ€§èƒ½
- **Given**: é…ç½®é‡‡é›† 50 ä¸ªæŒ‡æ ‡ï¼Œé—´éš” 10 ç§’
- **When**: è¿è¡Œé‡‡é›†æœåŠ¡
- **Then**:
  - é‡‡é›†å»¶è¿Ÿ < 1 ç§’ï¼ˆä»é‡‡é›†å¼€å§‹åˆ°æ•°æ®å­˜å‚¨ï¼‰
  - CPU å ç”¨ < 5%ï¼ˆå•æ ¸ï¼‰
  - å†…å­˜å ç”¨ < 100MB
  - ç£ç›˜å†™å…¥ < 1MB/åˆ†é’Ÿï¼ˆSQLiteï¼‰

### AC 3: å­˜å‚¨å¯é æ€§
- **Given**: é‡‡é›†æœåŠ¡è¿è¡Œä¸­
- **When**: ç³»ç»Ÿå¼‚å¸¸æ–­ç”µæˆ–å´©æºƒ
- **Then**:
  - æ•°æ®ä¸ä¸¢å¤±ï¼ˆWAL ä¿è¯ï¼‰
  - é‡å¯åè‡ªåŠ¨æ¢å¤é‡‡é›†
  - æ•°æ®å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡

### AC 4: æŸ¥è¯¢æ€§èƒ½
- **Given**: å­˜å‚¨äº† 30 å¤©çš„æ•°æ®ï¼ˆçº¦ 260 ä¸‡æ•°æ®ç‚¹ï¼‰
- **When**: æŸ¥è¯¢ 1 å¤©çš„æ•°æ®
- **Then**:
  - æŸ¥è¯¢å“åº”æ—¶é—´ < 3 ç§’
  - æŸ¥è¯¢ 7 å¤©æ•°æ® < 10 ç§’
  - æŸ¥è¯¢ 30 å¤©æ•°æ® < 30 ç§’

### AC 5: æ•°æ®å‹ç¼©æ•ˆç‡
- **Given**: åŸå§‹æ•°æ® 1GB
- **When**: æ‰§è¡Œæ•°æ®å‹ç¼©
- **Then**:
  - å‹ç¼©åæ•°æ® < 200MBï¼ˆå‹ç¼©æ¯” >= 5:1ï¼‰
  - å‹ç¼©æ—¶é—´ < 30 ç§’
  - å‹ç¼©åæ•°æ®å¯æ­£å¸¸æŸ¥è¯¢

### AC 6: æ•°æ®é™é‡‡æ ·
- **Given**: å­˜å‚¨äº† 90 å¤©çš„é«˜ç²¾åº¦æ•°æ®ï¼ˆ10 ç§’é—´éš”ï¼‰
- **When**: æ‰§è¡Œæ•°æ®é™é‡‡æ ·ç­–ç•¥ï¼ˆ30 å¤©åé™é‡‡æ ·ä¸º 1 åˆ†é’Ÿï¼‰
- **Then**:
  - è€æ•°æ®æ­£ç¡®é™é‡‡æ ·
  - é™é‡‡æ ·åæ•°æ®é‡å‡å°‘çº¦ 60%
  - é™é‡‡æ ·åæŸ¥è¯¢æ€§èƒ½æå‡

### AC 7: æ•°æ®å¯¼å‡ºå‡†ç¡®æ€§
- **Given**: å­˜å‚¨äº†æŒ‡æ ‡æ•°æ®
- **When**: å¯¼å‡ºä¸º Prometheus æ ¼å¼
- **Then**:
  - å¯¼å‡ºçš„æ•°æ®ç¬¦åˆ Prometheus æ ¼å¼è§„èŒƒ
  - æ•°æ®ç‚¹æ•°ä¸å­˜å‚¨çš„æ•°æ®ç‚¹æ•°ä¸€è‡´
  - æŒ‡æ ‡å€¼å‡†ç¡®ï¼ˆè¯¯å·® < 0.1%ï¼‰

### AC 8: é…ç½®çƒ­æ›´æ–°
- **Given**: é‡‡é›†æœåŠ¡è¿è¡Œä¸­
- **When**: ä¿®æ”¹é‡‡é›†é…ç½®ï¼ˆå¦‚é—´éš”ã€ä¿ç•™ç­–ç•¥ï¼‰
- **Then**:
  - é…ç½®ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯
  - é‡‡é›†æœåŠ¡ä¸ä¸­æ–­
  - æ–°é…ç½®æ­£ç¡®åº”ç”¨

## ä¾èµ–é¡¹

### ç³»ç»Ÿä¾èµ–
- **æ“ä½œç³»ç»Ÿ**: Linux (å†…æ ¸ >= 3.10)
- **Python**: Python 3.8+
- **ç£ç›˜ç©ºé—´**: è‡³å°‘ 10GB å¯ç”¨ç©ºé—´ï¼ˆå–å†³äºé‡‡é›†é¢‘ç‡å’Œä¿ç•™ç­–ç•¥ï¼‰

### Python åº“ä¾èµ–
```
psutil>=5.9.0          # ç³»ç»ŸæŒ‡æ ‡é‡‡é›†
pandas>=2.0.0          # æ•°æ®å¤„ç†
numpy>=1.24.0          # æ•°å€¼è®¡ç®—
click>=8.1.0           # CLI æ¡†æ¶
pyyaml>=6.0            # é…ç½®æ–‡ä»¶è§£æ
```

### å¯é€‰ä¾èµ–
```
influxdb-client>=1.36.0     # InfluxDB å­˜å‚¨
prometheus-client>=0.19.0   # Prometheus å…¼å®¹
sqlalchemy>=2.0.0           # æ•°æ®åº“æŠ½è±¡å±‚
```

## ä¼˜å…ˆçº§

**P0 (å¿…é¡»å®ç°)**
- AC 1: é‡‡é›†å‡†ç¡®æ€§
- AC 2: é‡‡é›†æ€§èƒ½
- AC 3: å­˜å‚¨å¯é æ€§
- æ ¸å¿ƒåŠŸèƒ½ç‚¹ 1, 2, 3

**P1 (é¦–ç‰ˆæœ¬å¿…å¤‡)**
- AC 4: æŸ¥è¯¢æ€§èƒ½
- AC 7: æ•°æ®å¯¼å‡º
- AC 8: é…ç½®çƒ­æ›´æ–°
- æ ¸å¿ƒåŠŸèƒ½ç‚¹ 4, 5, 8

**P2 (åç»­ç‰ˆæœ¬ä¼˜åŒ–)**
- AC 5: æ•°æ®å‹ç¼©
- AC 6: æ•°æ®é™é‡‡æ ·
- æ ¸å¿ƒåŠŸèƒ½ç‚¹ 6, 7

## è¾“å‡ºç¤ºä¾‹

### é‡‡é›†æœåŠ¡çŠ¶æ€è¾“å‡º
```bash
$ aiops collector status

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ é‡‡é›†æœåŠ¡çŠ¶æ€                                         2024-01-15 14:30:25 â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ æœåŠ¡çŠ¶æ€: âœ… Running (PID: 15234)                               â”‚
â”‚ è¿è¡Œæ—¶é•¿: 7d 12h 30m                                          â”‚
â”‚ é…ç½®æ–‡ä»¶: /etc/aiops/collector.yaml                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š é‡‡é›†é…ç½®:                                                     â”‚
â”‚   é‡‡é›†é—´éš”: 10 ç§’                                               â”‚
â”‚   æ‰¹é‡å¤§å°: 100 ä¸ªæ•°æ®ç‚¹                                         â”‚
â”‚   é‡‡é›†è¶…æ—¶: 5 ç§’                                               â”‚
â”‚   é‡è¯•æ¬¡æ•°: 3 æ¬¡                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¾ å­˜å‚¨é…ç½®:                                                     â”‚
â”‚   å­˜å‚¨åç«¯: SQLite                                               â”‚
â”‚   æ•°æ®ç›®å½•: /var/lib/aiops/data                                 â”‚
â”‚   æ•°æ®åº“æ–‡ä»¶: /var/lib/aiops/data/metrics.db                   â”‚
â”‚   æ•°æ®åº“å¤§å°: 2.3 GB                                            â”‚
â”‚   ä¿ç•™ç­–ç•¥: 30 å¤©                                               â”‚
â”‚   å‹ç¼©: å¯ç”¨ (Zstd level 3)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ˆ é‡‡é›†ç»Ÿè®¡:                                                     â”‚
â”‚   æ€»æ•°æ®ç‚¹: 15,234,567                                          â”‚
â”‚   é‡‡é›†æŒ‡æ ‡æ•°: 52                                                â”‚
â”‚   é‡‡é›†é€Ÿç‡: 312 æ•°æ®ç‚¹/ç§’                                       â”‚
â”‚   é‡‡é›†æˆåŠŸç‡: 99.97%                                            â”‚
â”‚   æœ€åé‡‡é›†: 2024-01-15 14:30:20 (5 ç§’å‰)                       â”‚
â”‚                                                                  â”‚
â”‚   ä»Šæ—¥é‡‡é›†: 2,523,456 æ•°æ®ç‚¹                                    â”‚
â”‚   ä»Šæ—¥å¤±è´¥: 756 æ•°æ®ç‚¹ (0.03%)                                  â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” æŒ‡æ ‡åˆ—è¡¨:                                                     â”‚
â”‚   ç³»ç»ŸæŒ‡æ ‡:                                                      â”‚
â”‚     â€¢ cpu.percent, cpu.idle, cpu.user, cpu.system              â”‚
â”‚     â€¢ mem.percent, mem.available, mem.used, mem.cached          â”‚
â”‚     â€¢ disk.io.read, disk.io.write, disk.await, disk.util       â”‚
â”‚     â€¢ net.rx.bytes, net.tx.bytes, net.rx.packets, net.tx.packets
â”‚     â€¢ loadavg.1, loadavg.5, loadavg.15                         â”‚
â”‚                                                                  â”‚
â”‚   è¿›ç¨‹æŒ‡æ ‡:                                                      â”‚
â”‚     â€¢ proc.count, proc.cpu, proc.mem, proc.io                  â”‚
â”‚     â€¢ proc.state.running, proc.state.sleeping, proc.state.zombie
â”‚                                                                  â”‚
â”‚   æ–‡ä»¶ç³»ç»ŸæŒ‡æ ‡:                                                  â”‚
â”‚     â€¢ fs.usage, fs.inodes, fs.files                            â”‚
â”‚                                                                  â”‚
â”‚   ç½‘ç»œæŒ‡æ ‡:                                                     â”‚
â”‚     â€¢ net.conn.count, net.tcp.estab, net.tcp.time_wait         â”‚
â”‚     â€¢ net.tcp.close_wait, net.udp.count                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š èµ„æºå ç”¨:                                                     â”‚
â”‚   CPU: 2.3% (å•æ ¸)                                             â”‚
â”‚   å†…å­˜: 85 MB                                                  â”‚
â”‚   ç£ç›˜å†™å…¥: 500 KB/s (å¹³å‡å€¼)                                   â”‚
â”‚   ç½‘ç»œæµé‡: 0 KB/s (æœ¬åœ°å­˜å‚¨)                                  â”‚
â”‚   æ–‡ä»¶å¥æŸ„: 128                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸  å‘Šè­¦:                                                         â”‚
â”‚   æ— å‘Šè­¦                                                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æŸ¥è¯¢è¾“å‡º
```bash
$ aiops query --metrics cpu.percent,mem.percent --period 1h --agg avg

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ æŒ‡æ ‡æŸ¥è¯¢ç»“æœ                                         2024-01-15 14:30:25 â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ æ—¶é—´èŒƒå›´: 2024-01-15 13:30:00 - 14:30:00                       â”‚
â”‚ æŒ‡æ ‡: cpu.percent, mem.percent                                  â”‚
â”‚ èšåˆ: avg (æŒ‰ 1 åˆ†é’Ÿèšåˆ)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š æŸ¥è¯¢ç»“æœæ‘˜è¦:                                                 â”‚
â”‚   æ•°æ®ç‚¹æ•°: 120 (60 åˆ†é’Ÿ Ã— 2 æŒ‡æ ‡)                              â”‚
â”‚   æŸ¥è¯¢æ—¶é—´: 0.23 ç§’                                             â”‚
â”‚                                                                  â”‚
â”‚   CPU ä½¿ç”¨ç‡:                                                   â”‚
â”‚     å¹³å‡: 52.3%                                                â”‚
â”‚     æœ€å¤§: 94.2% (14:15:23)                                     â”‚
â”‚     æœ€å°: 12.5% (13:35:10)                                    â”‚
â”‚     æ ‡å‡†å·®: 18.7                                               â”‚
â”‚                                                                  â”‚
â”‚   å†…å­˜ä½¿ç”¨ç‡:                                                    â”‚
â”‚     å¹³å‡: 58.7%                                                â”‚
â”‚     æœ€å¤§: 85.6% (14:18:45)                                     â”‚
â”‚     æœ€å°: 45.2% (13:30:00)                                    â”‚
â”‚     æ ‡å‡†å·®: 12.3                                               â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ˆ æ—¶åºæ•°æ® (Top 20 æ•°æ®ç‚¹):                                      â”‚
â”‚   æ—¶é—´                 â”‚ CPU % â”‚ Mem % â”‚                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚   2024-01-15 13:30:00 â”‚ 45.2  â”‚ 52.1  â”‚                        â”‚
â”‚   2024-01-15 13:31:00 â”‚ 46.8  â”‚ 52.3  â”‚                        â”‚
â”‚   2024-01-15 13:32:00 â”‚ 48.5  â”‚ 52.5  â”‚                        â”‚
â”‚   2024-01-15 13:33:00 â”‚ 47.2  â”‚ 52.8  â”‚                        â”‚
â”‚   2024-01-15 13:34:00 â”‚ 45.8  â”‚ 53.1  â”‚                        â”‚
â”‚   2024-01-15 13:35:00 â”‚ 43.5  â”‚ 53.5  â”‚ â¬‡ï¸ æœ€ä½                  â”‚
â”‚   2024-01-15 13:36:00 â”‚ 44.2  â”‚ 54.2  â”‚                        â”‚
â”‚   ...                  â”‚ ...   â”‚ ...   â”‚                        â”‚
â”‚   2024-01-15 14:15:00 â”‚ 92.8  â”‚ 78.5  â”‚ â¬†ï¸ ä¸Šå‡                  â”‚
â”‚   2024-01-15 14:15:23 â”‚ 94.2  â”‚ 80.3  â”‚ â¬†ï¸ æœ€é«˜                  â”‚
â”‚   2024-01-15 14:16:00 â”‚ 88.5  â”‚ 82.1  â”‚                        â”‚
â”‚   2024-01-15 14:17:00 â”‚ 75.3  â”‚ 83.5  â”‚                        â”‚
â”‚   2024-01-15 14:18:00 â”‚ 65.2  â”‚ 85.6  â”‚ â¬†ï¸ æœ€é«˜                  â”‚
â”‚   2024-01-15 14:19:00 â”‚ 58.4  â”‚ 84.2  â”‚                        â”‚
â”‚   2024-01-15 14:20:00 â”‚ 52.3  â”‚ 82.5  â”‚                        â”‚
â”‚   2024-01-15 14:21:00 â”‚ 48.7  â”‚ 80.1  â”‚                        â”‚
â”‚   ...                  â”‚ ...   â”‚ ...   â”‚                        â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ å¯¼å‡ºæ•°æ®:                                                      â”‚
â”‚   JSON æ ¼å¼: aiops query --output json > metrics.json           â”‚
â”‚   CSV æ ¼å¼: aiops query --output csv > metrics.csv              â”‚
â”‚   Prometheus æ ¼å¼: aiops export --format prometheus             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é…ç½®æ–‡ä»¶ç¤ºä¾‹

```yaml
# /etc/aiops/collector.yaml
collector:
  interval: 10s                    # é‡‡é›†é—´éš”
  timeout: 5s                      # é‡‡é›†è¶…æ—¶
  retry: 3                         # é‡è¯•æ¬¡æ•°
  batch_size: 100                  # æ‰¹é‡å†™å…¥å¤§å°

storage:
  backend: sqlite                  # å­˜å‚¨åç«¯: sqlite, influxdb, prometheus
  path: /var/lib/aiops/data        # æ•°æ®ç›®å½•
  retention: 30d                   # æ•°æ®ä¿ç•™æ—¶é—´
  compression: true                # å¯ç”¨å‹ç¼©
  compression_level: 3             # å‹ç¼©çº§åˆ« (1-9)

metrics:
  # CPU æŒ‡æ ‡
  cpu:
    enabled: true
    collect_percpu: true           # é‡‡é›†æ¯ä¸ª CPU æ ¸å¿ƒæŒ‡æ ‡
    collect_guest: true            # é‡‡é›† guest CPU æ—¶é—´

  # å†…å­˜æŒ‡æ ‡
  memory:
    enabled: true
    collect_detail: true           # é‡‡é›†è¯¦ç»†å†…å­˜æŒ‡æ ‡

  # ç£ç›˜æŒ‡æ ‡
  disk:
    enabled: true
    devices: ["sda", "sdb"]        # é‡‡é›†çš„ç£ç›˜è®¾å¤‡
    collect_partitions: true       # é‡‡é›†åˆ†åŒºä¿¡æ¯
    collect_inodes: true           # é‡‡é›† inode ä¿¡æ¯

  # ç½‘ç»œæŒ‡æ ‡
  network:
    enabled: true
    interfaces: ["eth0", "eth1"]   # é‡‡é›†çš„ç½‘ç»œæ¥å£
    collect_conntrack: true        # é‡‡é›†è¿æ¥è·Ÿè¸ª

  # è¿›ç¨‹æŒ‡æ ‡
  process:
    enabled: true
    top_n: 20                      # é‡‡é›† Top N è¿›ç¨‹
    collect_io: true               # é‡‡é›†è¿›ç¨‹ IO
    collect_fds: true              # é‡‡é›†æ–‡ä»¶æè¿°ç¬¦

# æ—¥å¿—é…ç½®
logging:
  level: INFO                      # æ—¥å¿—çº§åˆ«
  file: /var/log/aiops/collector.log
  max_size: 100MB
  max_backups: 10
```

## åç»­æ¼”è¿›æ–¹å‘

1. **åˆ†å¸ƒå¼é‡‡é›†**: æ”¯æŒå¤šä¸»æœºé›†ä¸­é‡‡é›†
2. **æµå¼å¤„ç†**: é›†æˆ Kafkaã€Flink æµå¼å¤„ç†
3. **è¾¹ç¼˜è®¡ç®—**: æ”¯æŒè¾¹ç¼˜è®¾å¤‡é‡‡é›†
4. **äº‘åŸç”Ÿæ”¯æŒ**: Kubernetes Operator
